---
title: "Palmer Penguins Analysis"
author: "Harish Sainath Sai Prasath (230164781)"
output: pdf_document
---
# Introduction
```{r setup, include=FALSE}
#Importing libraries and creating a subset
knitr::opts_chunk$set(echo = TRUE)
library(palmerpenguins)
library(ggplot2)
library(dplyr)
library(grid)
library(MASS)
my.student.number = 230164781
n=200
data("penguins")
penguins = na.omit(penguins)
set.seed(my.student.number)
my.penguins = penguins[sample(nrow(penguins), n), ]
rm(penguins_raw)
rm(penguins)
```
In this report, we aim to analyse a subset of the famous *Palmer Penguins* data set. The subset data used for analysis has `r n` entries and `r ncol(my.penguins)` different variables describing the penguins. These variables are *`r colnames(my.penguins)` *. Before diving deep into the data, let's try to get a better understanding about the penguins given in the data set by exploring all the variables, one at a time.

### Species and Islands:
- There are `r length(unique(my.penguins$island))` different islands and these are *`r unique(my.penguins$island)`*.
- We can observe from the below plot that, Biscoe is the most populated island followed by Dream and Torgersen. 
- There are `r length(unique(my.penguins$species))` species of penguins and they are *`r unique(my.penguins$species)`* respectively.
- Population of each species in these island is given in the below plot.


```{r echo=FALSE, fig.height=3}

my.penguins %>% 
  count(island, species) %>% 
  ggplot(aes(x = island, y = n, fill = species)) + 
  geom_col() + 
  geom_text(aes(label = n), 
            position = position_stack(vjust = 0.5), 
            color = "white") + 
  labs(title = "Penguin Population by Species and Island", 
       x = "Island", 
       y = "Population", 
       fill = "Species") + 
  theme_minimal() + 
  theme(legend.position = "bottom")

```

### Bill Length, Bill Depth, Flipper Length and Body Mass:
- To get an idea about the features of penguins, we will consider median as a the measure of central tendency because it is not affected if the data is skewed.
- The penguins have a median bill length of *`r median(my.penguins$bill_length_mm)` mm*.
- From the below box plots we can observe that Chinstrap Penguins has the highest median Bill length. This is closely followed by Gentoo penguins.
- Apart from the median bill lengths, a few interesting points can also be observed. Adelie is the most common type of penguin that is present in all three islands. Chinstrap is present only in Dream island, and Gentoo is present only present in Biscoe island.
- All penguins have a median bill depth of *`r median(my.penguins$bill_depth_mm)` mm*. Median bill depth for each species can be observed from the below box plots.
- Gentoo Penguins have the highest median flipper length and Adelie has the overall lowest median flipper length.
- The penguins have a median body mass of *`r median(my.penguins$body_mass_g)` g*.
- Gentoo penguins are the heaviest penguins in the dataset. Adelie penguins are the the least heavy of the group and chinstrap penguins are comparable to Adelie as per body mass is concerned.

```{r echo=FALSE,Include=FALSE, figures-side, fig.show="hold", out.width="50%" }
my.penguins %>% 
  ggplot(aes(x = island, y = bill_length_mm, color = species)) + 
  geom_boxplot() +
  stat_summary(fun = median, geom = "label", aes(label = round(after_stat(y), 1)), 
               position = position_nudge(x = 0)) + 
  labs(title = "Bill Length Distribution by Species and Island", 
       x = "Island", 
       y = "Bill Length in millimeters", 
       color = "Species") + 
  theme_minimal()+
  theme(legend.position = "none")

my.penguins %>% 
  ggplot(aes(x = island, y = flipper_length_mm, color = species)) + 
  geom_boxplot() +
  stat_summary(fun = median, geom = "label", aes(label = round(after_stat(y), 1)), 
               position = position_nudge(x = 0)) + 
  labs(title = "Flipper Length Distribution by Species and Island", 
       x = "Island", 
       y = "Flipper Length in millimeters", 
       color = "Species") + 
  theme_minimal()


```


```{r echo=FALSE, figures-side2, fig.show="hold", out.width="50%"}
 my.penguins %>% 
  ggplot(aes(x = island, y = bill_depth_mm, color = species)) + 
  geom_boxplot() +
  stat_summary(fun = median, geom = "label", aes(label = round(after_stat(y), 1)), 
               position = position_dodge(width = 0.75)) + 
  labs(title = "Bill Depth Distribution by Species and Island", 
       x = "Island", 
       y = "Bill Depth in grams", 
       color = "Species" ) + 
  theme_minimal()+
  theme(legend.position = "none")

my.penguins %>% 
  ggplot(aes(x = island, y = body_mass_g, color = species)) + 
  geom_boxplot() +
  stat_summary(fun = median, geom = "label", aes(label = round(after_stat(y), 1)), 
               position = position_dodge(width = 0.75)) + 
  labs(title = "Body Mass Distribution by Species and Island", 
       x = "Island", 
       y = "Body Mass in grams", 
       color = "Species") + 
  theme_minimal()

```

### Year and Sex  : 
- The data is collected for `r length(unique(my.penguins$year))` years and these are *`r unique(my.penguins$year)`* respectively. There are `r my.penguins%>%summarise(totalFemales = sum(sex == "female"))` female penguins and `r my.penguins%>%summarise(totalMales = sum(sex == "male"))` male penguins in the dataset.

# Distribution Fitting and Population Proportion Estimation

Let's take one Body mass of penguins and fit a distribution for proportion estimation. For getting initial impressions of how the data is distributed, let's plot a density plot. Also a lot of things in nature are observed to be falling under a normal distribution. So Let's use a q-q plot to check if body mass can be fitted using a Normal/Gaussian distribution. 

```{r echo=FALSE, Distribution_Check,fig.show="hold", out.width="50%"}
options(scipen = 999)

ggplot(data = my.penguins, aes(x = body_mass_g)) +
  geom_density(fill = "red", alpha = 0.7, color = "black") +  # Plot density
  labs(title = "Density of Body Mass of penguins",
       x = "Body Mass (grams)",
       y = "Density") +
  theme_minimal()

qqnorm(my.penguins$body_mass_g)
qqline(my.penguins$body_mass_g,col="red")
```

Two major things can be observed the above plots.

- q-q plot shows that fitting a normal distribution might not be the best choice for good parameter estimations.
- Distribution of body mass seems to right skewed.

Now we have to look for some other distribution to fit the data. The body mass is a positive value and the data is right skewed, *Log-Normal Distribution* might be a good choice to fit the data.

so let's fit Log-Normal Distribution to our data. 

### Fitting the Data to a Log-Normal Distribution
Probability density function for a Log-Normal distribution is given by
\begin{align*}
f(x) = \frac{1}{x \sigma\sqrt{2 \pi}} e^{\left[ - \frac{(ln(x) - \mu)^2}{2 \sigma^2} \right]}
   \end{align*}
   
- $\mu$ is the mean of the normal distribution. 
- $\sigma$ is the standard deviation of the normal distribution. 
- $n$ is equal to 200 in our case.

Likelihood function:
\begin{align*}
L(\mu, \sigma | x_n) &= \prod_{i=1}^{n} \left[\frac{1}{\sqrt{2\pi}\sigma x_{i}}e^{-\frac{1}{2\sigma^{2}}(lnx_{i}-\mu)^{2}}\right] \\
\end{align*}
Rearranging the above equation to make the calculations convenient
\begin{align*}
L(\mu, \sigma | x_n) &= \frac{1}{(2\pi)^{\frac{n}{2}}\frac{1}{(\sigma^{2})^{\frac{n}{2}}}}\prod_{i=1}^{n} \left[(\frac{1}{x_{i}})e^{-\frac{1}{2\sigma^{2}}\Sigma(lnx_{i}-\mu)^{2}}\right] \\
\text{taking ln on both sides }\\
\ln L(\mu, \sigma^{2} | x_n) &= \ln 1 - \frac{n}{2}\ln\pi + \ln 1 - \frac{n}{2}\ln\sigma^{2} + \ln(x_{1}.x_{2}....x_{n}) - \frac{1}{2\sigma^{2}}\Sigma(lnx_{i}-\mu)^{2}\ln e \\\\
\ln L(\mu,\sigma^{2}| x_n) &= -\frac{n}{2}\ln\pi-\frac{n}{2}\ln~\sigma^{2}+\sum ln x_{i}-\frac{1}{2\sigma^{2}}\sum(ln x_{i}-\mu)^{2} & ...(1)
\end{align*}
   
Where (1) is the log likelihood function

Now partially differentiating (1) we find equations for $\mu$ and $\sigma$.

- To estimate parameter $\mu$ (Mean) we differentiate the log-likelihood with respect to $\mu$
\begin{align*}
\frac{\partial}{\partial \mu} lnL(\mu, \sigma^2|x_n) = \frac{1}{\sigma^2} \sum_{i=1}^{n} (ln(x_i) - \mu)\\
\frac{\partial}{\partial \mu} lnL(\mu, \sigma^2) = 0\\
\text{Solving this equation we get,}\\
\text{mean: } & \hat{\mu} = \frac{1}{n} \sum_{i=1}^{n} \ln(x_i)
\end{align*}
-To estimate parameter for $\sigma^2$ (Variance) we differentiate the log-likelihood with respect to $\sigma^2$
\begin{align*}
\frac{\partial}{\partial \sigma^2} lnL(\mu, \sigma^2 |x_n) = -\frac{n}{2\sigma^2} - \frac{1}{2\sigma^4} \sum_{i=1}^{n} (ln(x_i) - \mu)^2\\
\text{by solving this equation, we get}\\
\hat{\sigma}^2 = \frac{1}{n} \sum_{i=1}^{n} (\ln(x_i) - \hat \mu)^2\\
\text{Standard deviation: } & \hat{\sigma}= \sqrt{\frac{1}{n} \sum_{i=1}^{n} (\ln(x_i) - \hat{\mu})^{2}}\\
\end{align*}

```{r echo=FALSE, Distribution_fit,fig.show="hold", out.width="50%"}
body_mass = my.penguins$body_mass_g  # Original data

# Step 1: Log-transform the body mass
log_body_mass = log(body_mass)

# Step 2: Compute MLE for mu (mean of the log-transformed data)
n = length(log_body_mass)  # Number of observations
mu_mle = sum(log_body_mass) / n  # MLE for mu

# Step 3: Compute MLE for sigma^2 (variance of the log-transformed data)
sigma2_mle = sum((log_body_mass - mu_mle)^2) / n  # MLE for sigma^2
sigma_mle = sqrt(sigma2_mle)  # Standard deviation (square root of variance)

# Step 4: Create a sequence of x values for plotting the fitted curve
x_vals = seq(min(body_mass), max(body_mass), length.out = 100)

# Step 5: Get the log-normal density curve using MLE mu and sigma
log_normal_density = dlnorm(x_vals, meanlog = mu_mle, sdlog = sigma_mle)

# Step 6: Combine x_vals and log_normal_density into a data frame for ggplot
density_data = data.frame(x_vals = x_vals, log_normal_density = log_normal_density)

# Step 7: Plot the empirical density and the fitted log-normal curve
ggplot(data.frame(body_mass), aes(x = body_mass)) +
  geom_density(aes(y = after_stat(density)), fill = "steelblue", color = "black") +
  geom_line(data = density_data, aes(x = x_vals, y = log_normal_density), color = "red", linewidth = 1) +
  labs(title = "Body Mass Distribution with Fitted LogNormal Curve (Using MLE)",
       x = "Body Mass (g)", y = "Density") +
  theme_minimal()

# Step 8: Print the MLE estimates for mu and sigma
cat("MLE for mu (mean of log body mass):", mu_mle, "\n")
cat("MLE for sigma (standard deviation of log body mass):", sigma_mle, "\n")

```

### Key Observations: 
- While Log-Normal represents skewness, it still does not match the actual data. But this is far better than Normal distribution where skewness is zero.
- A more sophisticated model like gamma distribution would better represent the data that is presented.

# Determination of Sex
Determination of sex among penguins is often a difficult process where a lot of distress is caused to the penguins. Here, we look to use the available data to determine the sex of the penguins, thereby avoiding any invasive procedures.

Now, we will be looking at the following variables and compare the means of specific variable between two sexes. The t-test that we will be performing will give us an idea if there is a significant difference between the variable for each sex.

- Bill Length
- Bill Depth
- Flipper Length
- Body Mass

Let's perform t-test 



#### Note: We are assuming variances of two groups are equal
```{r}
options(scipen = 999)
options(width = 100)
t.test(bill_length_mm ~ sex, data = my.penguins,var.equal=TRUE)
t.test(bill_depth_mm ~ sex, data = my.penguins,var.equal=TRUE)
t.test(flipper_length_mm ~ sex, data = my.penguins,var.equal=TRUE)
t.test(body_mass_g ~ sex, data = my.penguins,var.equal=TRUE)
```




# Difference in Physical Characterstics of Penguins between Islands

```{r}
# Perform a one-way ANOVA for each physical characteristic
# Bill length by island
anova_bill_length <- aov(bill_length_mm ~ island, data = my.penguins)
summary(anova_bill_length)

# Bill depth by island
anova_bill_depth <- aov(bill_depth_mm ~ island, data = my.penguins)
summary(anova_bill_depth)

# Flipper length by island
anova_flipper_length <- aov(flipper_length_mm ~ island, data = my.penguins)
summary(anova_flipper_length)

# Body mass by island
anova_body_mass <- aov(body_mass_g ~ island, data = my.penguins)
summary(anova_body_mass)

```




